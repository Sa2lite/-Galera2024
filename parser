import requests
from bs4 import BeautifulSoup

def get_vacancy_links(search_query, pages=40):
    vacancy_links = []
    
    for page in range(pages):
        url = f'https://hh.ru/search/vacancy?text={search_query}&page={page}'
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'}
        
        response = requests.get(url, headers=headers)
        
        if response.status_code == 200:
            soup = BeautifulSoup(response.text, 'html.parser')
            
            vacancies = soup.select('span.serp-item__title-link-wrapper a.bloko-link')
            for vacancy in vacancies:
                vacancy_links.append(vacancy['href'])
        else:
            print(f"Ошибка {page}: {response.status_code}")
    
    return vacancy_links


def get_vacancy_details(vacancy_url, search_query):
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'}
    
    response = requests.get(vacancy_url, headers=headers)
    
    if response.status_code == 200:
        soup = BeautifulSoup(response.text, 'html.parser')
        
        title_element = soup.find('h1', {'data-qa': 'vacancy-title'})
        title = title_element.text.strip() if title_element else "Title not found"
        title += f" ({search_query})"
        
        salary_element = soup.find('span', {'data-qa': 'vacancy-salary-compensation-type-net'})
        salary = salary_element.text.strip() if salary_element else "зарплата не указана"
        
        experience_element = soup.find('span', {'data-qa': 'vacancy-experience'})
        experience = experience_element.text.strip() if experience_element else "Без опыта"
        
        viewers_element = soup.find('span', class_='vacancy-viewers-count')
        viewers = viewers_element.text.strip() if viewers_element else "Никто не просматривает вакансию"
        
        if salary:
            return title, salary, experience, viewers
        else:
            return None, None, None, None
    else:
        print(f"Ошибка: {response.status_code}")
        return None, None, None, None
